#!/usr/bin/env bash
pacman_conf="/etc/pacman.conf"
pacman_conf_v2="/etc/pacman-v2.conf"
pacman_conf_v3="/etc/pacman-v3.conf"
pacman_conf_path_backup="/etc/pacman.conf.bak"

if [[ $(/lib/ld-linux-x86-64.so.2 --help | grep "x86_64v3 (supported, searched)") != "" ]]; then
    # Get ALHP Keyring and Mirrorlist
    echo "Enabling x86_64v3 Repositories"
    pacman -Sy alhp-keyring alhp-mirrorlist

    # Backup default pacman,conf
    echo "Backup default pacman config"
    mv $pacman_conf $pacman_conf_path_backup

    # Setup v3-repo list
    mv $pacman_conf_v3 $pacman_conf

    echo "Adding x86_64v3 Repo Succefull"
else
    echo 'Machine don`t support x86_64v3 micro-architecture'
fi

if [[ $(/lib/ld-linux-x86-64.so.2 --help | grep "x86_64v3 (supported, searched)") == "" && $(/lib/ld-linux-x86-64.so.2 --help | grep "x86_64v2 (supported, searched)") != "" ]]; then
    # Get ALHP Keyring and Mirrorlist
    echo "Enabling x86_64v2 Repositories"
    pacman -Sy alhp-keyring alhp-mirrorlist

    # Backup default pacman,conf
    echo "Backup default pacman configuration"
    mv $pacman_conf $pacman_conf_path_backup

    # Setup v3-repo list
    echo "Setup pacman configuration"
    mv $pacman_conf_v2 $pacman_conf

    echo "Adding x86_64v2 Repo Succefull"
else
    echo 'Machine don`t support x86_64v2 micro-architecture'
fi

echo "Cleaning Unused files"
rm -rf $pacman_conf_v2 $pacman_conf_v3
exit 0
